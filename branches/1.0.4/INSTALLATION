HOW TO INSTALL GOOGLE CHECKOUT MODULE FOR ZEN-CART

If you haven't read the README file yet, please read it first.

There are two installation options you need to choose from, so please read carefully to determine which option is right for you.
* Note: The folder YOUR_TEMPLATE refers to the folder that contains your templates.

OPTION A: 
=========
If you have the basic Zen Cart installation without any other modules or add-on's, simply copy the provided files into your Zen Cart system, preserving the file structure.

 For your reference, here is the list of files you need to copy over to your system:

   1. YOUR_ZENCART_FOLDER/admin/orders.php
   2. YOUR_ZENCART_FOLDER/admin/includes/functions/extra_functions/added_function_for_google_checkout.php
   3. YOUR_ZENCART_FOLDER/googlecheckout/gcheckout.php
   4. YOUR_ZENCART_FOLDER/googlecheckout/responsehandler.php
   5. YOUR_ZENCART_FOLDER/googlecheckout/response_error.log
   6. YOUR_ZENCART_FOLDER/googlecheckout/response_message.log
   7. YOUR_ZENCART_FOLDER/googlecheckout/xmlbuilder.php
   8. YOUR_ZENCART_FOLDER/googlecheckout/xmlparser.php
   9. YOUR_ZENCART_FOLDER/includes/languages/english/modules/payment/googlecheckout.php
  10. YOUR_ZENCART_FOLDER/includes/modules/payment/googlecheckout.php
  11. YOUR_ZENCART_FOLDER/includes/modules/show_google_components.php
  12. YOUR_ZENCART_FOLDER/includes/templates/YOUR_TEMPLATE/templates/tpl_checkout_payment_default.php
  13. YOUR_ZENCART_FOLDER/includes/templates/YOUR_TEMPLATE/templates/tpl_login_default.php
  14. YOUR_ZENCART_FOLDER/includes/templates/YOUR_TEMPLATE/templates/tpl_shopping_cart_default.php



OPTION B:
=========
If you have other modules installed on your Zen Cart installation, replacing your existing files might break your existing installation. In this case, you need to edit the existing files manually.

 For this option, follow the instructions below:

 I. Copy the following new files into your existing system, preserving the file structure:
 -----------------------------------------------------------------------------------------
   1. YOUR_ZENCART_FOLDER/admin/includes/functions/extra_functions/added_function_for_google_checkout.php
   2. YOUR_ZENCART_FOLDER/googlecheckout/gcheckout.php
   3. YOUR_ZENCART_FOLDER/googlecheckout/responsehandler.php
   4. YOUR_ZENCART_FOLDER/googlecheckout/response_error.log
   5. YOUR_ZENCART_FOLDER/googlecheckout/response_message.log
   6. YOUR_ZENCART_FOLDER/googlecheckout/xmlbuilder.php
   7. YOUR_ZENCART_FOLDER/googlecheckout/xmlparser.php
   8. YOUR_ZENCART_FOLDER/includes/languages/english/modules/payment/googlecheckout.php
   9. YOUR_ZENCART_FOLDER/includes/modules/payment/googlecheckout.php
  10. YOUR_ZENCART_FOLDER/includes/modules/show_google_components.php


 II. Manually edit the following files from your system as instructed below:
 ---------------------------------------------------------------------------
  1. YOUR_ZENCART_FOLDER/admin/orders.php
  2. YOUR_ZENCART_FOLDER/includes/templates/YOUR_TEMPLATE/templates/tpl_checkout_payment_default.php
  3. YOUR_ZENCART_FOLDER/includes/templates/YOUR_TEMPLATE/templates/tpl_login_default.php
  4. YOUR_ZENCART_FOLDER/includes/templates/YOUR_TEMPLATE/templates/tpl_shopping_cart_default.php


* The LINE number indicates where the change would need to be made if the file was unchanged by other modules.

----------------------------------------------------------------------------
1. YOUR_ZENCART_FOLDER/admin/orders.php                              LINE 88
============================================================================
REPLACE:

  //send emails
      $message = STORE_NAME . "\n" . EMAIL_SEPARATOR . "\n" .
      EMAIL_TEXT_ORDER_NUMBER . ' ' . $oID . "\n\n" .
      EMAIL_TEXT_INVOICE_URL . ' ' . zen_catalog_href_link(FILENAME_CATALOG_ACCOUNT_HISTORY_INFO, 'order_id=' . $oID, 'SSL') . "\n\n" .
      EMAIL_TEXT_DATE_ORDERED . ' ' . zen_date_long($check_status->fields['date_purchased']) . "\n\n" .
      strip_tags($notify_comments) .
      EMAIL_TEXT_STATUS_UPDATED . sprintf(EMAIL_TEXT_STATUS_LABEL, $orders_status_array[$status] ) .
      EMAIL_TEXT_STATUS_PLEASE_REPLY;

      $html_msg['EMAIL_CUSTOMERS_NAME']    = $check_status->fields['customers_name'];
      $html_msg['EMAIL_TEXT_ORDER_NUMBER'] = EMAIL_TEXT_ORDER_NUMBER . ' ' . $oID;
      $html_msg['EMAIL_TEXT_INVOICE_URL']  = '<a href="' . zen_catalog_href_link(FILENAME_CATALOG_ACCOUNT_HISTORY_INFO, 'order_id=' . $oID, 'SSL') .'">'.str_replace(':','',EMAIL_TEXT_INVOICE_URL).'</a>';
      $html_msg['EMAIL_TEXT_DATE_ORDERED'] = EMAIL_TEXT_DATE_ORDERED . ' ' . zen_date_long($check_status->fields['date_purchased']);
      $html_msg['EMAIL_TEXT_STATUS_COMMENTS'] = nl2br($notify_comments);
      $html_msg['EMAIL_TEXT_STATUS_UPDATED'] = str_replace('\n','', EMAIL_TEXT_STATUS_UPDATED);
      $html_msg['EMAIL_TEXT_STATUS_LABEL'] = str_replace('\n','', sprintf(EMAIL_TEXT_STATUS_LABEL, $orders_status_array[$status] ));
      $html_msg['EMAIL_TEXT_NEW_STATUS'] = $orders_status_array[$status];
      $html_msg['EMAIL_TEXT_STATUS_PLEASE_REPLY'] = str_replace('\n','', EMAIL_TEXT_STATUS_PLEASE_REPLY);

            zen_mail($check_status->fields['customers_name'], $check_status->fields['customers_email_address'], EMAIL_TEXT_SUBJECT . ' #' . $oID, $message, STORE_NAME, EMAIL_FROM, $html_msg, 'order_status');

            $customer_notified = '1';
  //send extra emails
            if (SEND_EXTRA_ORDERS_STATUS_ADMIN_EMAILS_TO_STATUS == '1' and SEND_EXTRA_ORDERS_STATUS_ADMIN_EMAILS_TO != '') {
              zen_mail('', SEND_EXTRA_ORDERS_STATUS_ADMIN_EMAILS_TO, SEND_EXTRA_ORDERS_STATUS_ADMIN_EMAILS_TO_SUBJECT . ' ' . EMAIL_TEXT_SUBJECT . ' #' . $oID, $message, STORE_NAME, EMAIL_FROM, $html_msg, 'order_status_extra');
            }
          }

WITH:

// ** GOOGLE CHECKOUT **
            chdir("./..");
            require_once(DIR_WS_LANGUAGES . $_SESSION['language'] . '/modules/payment/googlecheckout.php');
            $payment_value= MODULE_PAYMENT_GOOGLECHECKOUT_TEXT_TITLE;
            $result = $db->Execute("select google_order_number from google_orders where orders_id= ". (int)$oID);
            $num_rows = $result->RecordCount();

      if($num_rows == 0) {
//send emails
      $message = STORE_NAME . "\n" . EMAIL_SEPARATOR . "\n" .
      EMAIL_TEXT_ORDER_NUMBER . ' ' . $oID . "\n\n" .
      EMAIL_TEXT_INVOICE_URL . ' ' . zen_catalog_href_link(FILENAME_CATALOG_ACCOUNT_HISTORY_INFO, 'order_id=' . $oID, 'SSL') . "\n\n" .
      EMAIL_TEXT_DATE_ORDERED . ' ' . zen_date_long($check_status->fields['date_purchased']) . "\n\n" .
      strip_tags($notify_comments) .
      EMAIL_TEXT_STATUS_UPDATED . sprintf(EMAIL_TEXT_STATUS_LABEL, $orders_status_array[$status] ) .
      EMAIL_TEXT_STATUS_PLEASE_REPLY;

      $html_msg['EMAIL_CUSTOMERS_NAME']    = $check_status->fields['customers_name'];
      $html_msg['EMAIL_TEXT_ORDER_NUMBER'] = EMAIL_TEXT_ORDER_NUMBER . ' ' . $oID;
      $html_msg['EMAIL_TEXT_INVOICE_URL']  = '<a href="' . zen_catalog_href_link(FILENAME_CATALOG_ACCOUNT_HISTORY_INFO, 'order_id=' . $oID, 'SSL') .'">'.str_replace(':','',EMAIL_TEXT_INVOICE_URL).'</a>';
      $html_msg['EMAIL_TEXT_DATE_ORDERED'] = EMAIL_TEXT_DATE_ORDERED . ' ' . zen_date_long($check_status->fields['date_purchased']);
      $html_msg['EMAIL_TEXT_STATUS_COMMENTS'] = nl2br($notify_comments);
      $html_msg['EMAIL_TEXT_STATUS_UPDATED'] = str_replace('\n','', EMAIL_TEXT_STATUS_UPDATED);
      $html_msg['EMAIL_TEXT_STATUS_LABEL'] = str_replace('\n','', sprintf(EMAIL_TEXT_STATUS_LABEL, $orders_status_array[$status] ));
      $html_msg['EMAIL_TEXT_NEW_STATUS'] = $orders_status_array[$status];
      $html_msg['EMAIL_TEXT_STATUS_PLEASE_REPLY'] = str_replace('\n','', EMAIL_TEXT_STATUS_PLEASE_REPLY);

            zen_mail($check_status->fields['customers_name'], $check_status->fields['customers_email_address'], EMAIL_TEXT_SUBJECT . ' #' . $oID, $message, STORE_NAME, EMAIL_FROM, $html_msg, 'order_status');

            $customer_notified = '1';
//send extra emails
            if (SEND_EXTRA_ORDERS_STATUS_ADMIN_EMAILS_TO_STATUS == '1' and SEND_EXTRA_ORDERS_STATUS_ADMIN_EMAILS_TO != '') {
              zen_mail('', SEND_EXTRA_ORDERS_STATUS_ADMIN_EMAILS_TO, SEND_EXTRA_ORDERS_STATUS_ADMIN_EMAILS_TO_SUBJECT . ' ' . EMAIL_TEXT_SUBJECT . ' #' . $oID, $message, STORE_NAME, EMAIL_FROM, $html_msg, 'order_status_extra');
            }
          }
          else {
	          $customer_notified = '1';
	          google_checkout_state_change($check_status, $status, $oID, $customer_notified, $notify_comments);
    	  }
    	  }
// ** END GOOGLE CHECKOUT **


-------------------------------------------------------------------------------------------------------------------------------
2. YOUR_ZENCART_FOLDER/includes/templates/YOUR_TEMPLATE/templates/tpl_checkout_payment_default.php    LINE 127
===============================================================================================================================
REPLACE:

  <?php
    if (sizeof($selection) > 1) {
  ?>

WITH:

  <?php
    if (sizeof($selection) > 1) {

    // ** GOOGLE CHECKOUT **
      if($selection[$i]['id'] == "googlecheckout") 
        continue;
    // ** END GOOGLE CHECKOUT **
  ?>


-------------------------------------------------------------------------------------------------------------------
3. YOUR_ZENCART_FOLDER/includes/templates/YOUR_TEMPLATE/templates/tpl_login_default.php    LINE 41
===================================================================================================================
REPLACE:

  <br class="clearBoth" />

  <?php echo zen_draw_form('create_account', zen_href_link(FILENAME_CREATE_ACCOUNT, '', 'SSL'), 'post', 'onsubmit="return check_form(create_account);"') . zen_draw_hidden_field('action', 'process') . zen_draw_hidden_field('email_pref_html', 'email_format'); ?>

WITH:

  <br class="clearBoth" />
  
  // ** GOOGLE CHECKOUT **
    <?php  include(DIR_WS_MODULES . 'show_google_components.php');  ?>
  // ** END GOOGLE CHECKOUT **

  <?php echo zen_draw_form('create_account', zen_href_link(FILENAME_CREATE_ACCOUNT, '', 'SSL'), 'post', 'onsubmit="return check_form(create_account);"') . zen_draw_hidden_field('action', 'process') . zen_draw_hidden_field('email_pref_html', 'email_format'); ?>


----------------------------------------------------------------------------------------------------------------------------
4. YOUR_ZENCART_FOLDER/includes/templates/YOUR_TEMPLATE/templates/tpl_shopping_cart_default.php    LINE 181
============================================================================================================================
REPLACE:

  <?php require($template->get_template_dir('tpl_modules_whats_new.php',DIR_WS_TEMPLATE, $current_page_base,'templates'). '/tpl_modules_whats_new.php'); ?>

  <?php
    }
  ?>

  </div>

WITH:

  <?php require($template->get_template_dir('tpl_modules_whats_new.php',DIR_WS_TEMPLATE, $current_page_base,'templates'). '/tpl_modules_whats_new.php'); ?>

  <?php
    }
  ?>

  // ** GOOGLE CHECKOUT **
    <?php  include(DIR_WS_MODULES . 'show_google_components.php');  ?>
  // ** END GOOGLE CHECKOUT **

  </div>
